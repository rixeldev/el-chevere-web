---
import LazyImage from '@/components/LazyImage.astro'
import MainTitle from '@/components/MainTitle.astro'
import SectionContainer from '@/components/SectionContainer.astro'
import { Loading } from '@/icons/Loading'
import UpArrow from '@/icons/UpArrow.astro'
import { getI18N } from '@/languages/index'
import Layout from '@/layouts/Layout.astro'
import { getCategories } from '@/services/categories'
import 'photoswipe/style.css'

const id = Astro.params.id
const currentLocale = Astro.currentLocale
const i18N = getI18N({ currentLocale })
const category = getCategories(currentLocale).find((category) => category.id === id)
---

<Layout
	title={`${category?.name} - Foto Estudio El ChÃ©vere - Official Web`}
	description={i18N.PAGE_DESCRIPTION}
	canonical={`https://fotoestudioelchevere.com/portfolio/${id}`}
>
	<SectionContainer>
		<div class='flex w-full max-w-6xl flex-col md:w-11/12 lg:w-10/12'>
			<MainTitle>
				<div>
					<UpArrow
						class='back-button size-12 -rotate-90 cursor-pointer rounded-2xl border border-accent/20 bg-glass p-2 text-accent backdrop-blur-sm transition-all duration-300 hover:border-accent/40 hover:bg-accent/10 hover:scale-110 active:scale-95'
					/>
				</div>

				{category?.name}
			</MainTitle>

			<p class='mb-8 text-pretty text-lg leading-relaxed text-secondary'>{category?.description}</p>

			<!-- Masonry with Grid -->
			<div id='gallery' style='column-gap: 1.5rem; column-width: 280px;'>
				{
					category?.images
						?.sort(() => Math.random() - 0.5)
						.map((image, index) => (
							<a
								href={`${image.src}`}
								data-pswp-width={image.width}
								data-pswp-height={image.height}
								target='_blank'
								class='hoverZoomLink group relative mb-6 block cursor-zoom-in break-inside-avoid overflow-hidden rounded-2xl border border-accent/10 bg-glass backdrop-blur-sm transition-all duration-500 hover:border-accent/30 hover:shadow-xl hover:shadow-accent/20'
							>
								<div class='absolute inset-0 z-10 bg-gradient-to-t from-back/40 via-transparent to-transparent opacity-0 transition-opacity duration-500 group-hover:opacity-100'></div>
								<LazyImage
									src={`https://www.fotoestudioelchevere.com/${image.src}`}
									alt={`Image ${index + 1}`}
									width={image.width}
									height={image.height}
									className='w-full transition-transform duration-700 ease-in-out group-hover:scale-105'
								/>

								<Loading
									client:visible
									classes='-z-20 inset-0 absolute m-auto size-6 text-accent'
								/>
							</a>
						))
				}
			</div>
		</div>
	</SectionContainer>
</Layout>

<script>
	import { $ } from '@/libs/dom-selector'
	import PhotoSwipeLightbox from 'photoswipe/lightbox'

	document.addEventListener('astro:page-load', () => {
		const lightbox = new PhotoSwipeLightbox({
			gallery: '#gallery',
			children: 'a',
			showAnimationDuration: 200,
			hideAnimationDuration: 200,
			zoomAnimationDuration: 200,
			showHideAnimationType: 'zoom',
			pswpModule: () => import('photoswipe'),
		})
		lightbox.init()

		const backButton = $('.back-button')
		backButton?.addEventListener('click', () => {
			history.back()
		})
	})
</script>
